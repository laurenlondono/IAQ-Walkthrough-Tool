<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IAQ Building Walkthrough Assessment - Go Green Initiative</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #f7fff4 0%, #f1f8e9 100%);
      color: #222;
      min-height: 100vh;
    }
    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: linear-gradient(90deg, #8DC63F 0%, #4C9A2A 100%);
      padding: 24px 0 18px 0;
      margin-bottom: 30px;
      border-bottom-left-radius: 36px;
      border-bottom-right-radius: 36px;
      box-shadow: 0 2px 10px rgba(76,154,42,0.10);
    }
    .logo {
      width: 150px;
      margin-bottom: 10px;
    }
    h1 {
      color: #fff;
      letter-spacing: 1px;
      font-weight: 700;
      margin: 0 0 10px 0;
      font-size: 2.1em;
      text-shadow: 0 2px 8px #0001;
    }
    .tagline {
      color: #e5ffe0;
      font-size: 1.08em;
      margin-bottom: 2px;
      letter-spacing: 0.5px;
      font-weight: 500;
    }
    form {
      max-width: 900px;
      margin: 0 auto 40px auto;
      padding: 28px 32px 36px 32px;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 8px 34px #b9e6a945;
      border: 2px solid #8DC63F44;
    }
    .section {
      margin: 34px 0 28px 0;
      border-top: 2px solid #c8e6c9;
      padding-top: 22px;
      background: linear-gradient(90deg, #f3fce7 0%, #e0f5e1 100%);
      border-radius: 9px;
      box-shadow: 0 1px 7px #e3f0ff22;
    }
    label.section-title {
      font-size: 1.16em;
      font-weight: 700;
      margin-bottom: 10px;
      display: block;
      color: #4C9A2A;
      letter-spacing: 0.5px;
    }
    .question-group {
      margin-bottom: 16px;
    }
    .flex {
      display: flex;
      gap: 14px;
      align-items: center;
      flex-wrap: wrap;
    }
    .notes {
      width: 245px;
      border-radius: 4px;
      border: 1px solid #A3D173;
      padding: 6px;
      background: #f4faff;
    }
    select, input[type=text], input[type=email], textarea, input[type=date] {
      font-size: 1em;
      font-family: 'Roboto', Arial, sans-serif;
      border-radius: 4px;
      border: 1.2px solid #A3D173;
      padding: 7px 8px;
      margin-top: 2px;
      background: #f6fff4;
      transition: border-color .2s;
    }
    select:focus, input:focus, textarea:focus {
      border-color: #4C9A2A;
      outline: none;
      background: #f2fbf2;
    }
    input[type=text], input[type=email], textarea { width: 215px; }
    input[type=date] { width: 145px; }
    textarea { min-height: 30px; }
    .room-block {
      border: 2.2px solid #8DC63F;
      border-radius: 14px;
      padding: 21px 18px 15px 18px;
      margin-bottom: 28px;
      background: linear-gradient(100deg, #f6fff4 50%, #e9f8ef 100%);
      position: relative;
      box-shadow: 0 1px 12px #8dc63f22;
    }
    .remove-room-btn {
      background: #f45060;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 4px 13px;
      font-size: 1em;
      cursor: pointer;
      position: absolute;
      top: 11px;
      right: 11px;
      font-family: 'Roboto', Arial, sans-serif;
      font-weight: 700;
      letter-spacing: 0.5px;
      transition: background .18s;
    }
    .remove-room-btn:hover {
      background: #ad1a34;
    }
    .add-room-btn {
      background: linear-gradient(90deg, #8DC63F 0%, #4C9A2A 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 1.13em;
      font-family: 'Roboto', Arial, sans-serif;
      cursor: pointer;
      margin-bottom: 22px;
      margin-top: 7px;
      font-weight: 700;
      letter-spacing: 0.5px;
      box-shadow: 0 3px 12px #4C9A2A22;
      transition: background .18s;
    }
    .add-room-btn:hover {
      background: linear-gradient(90deg, #4C9A2A 0%, #8DC63F 100%);
    }
    .room-title {
      font-weight: bold;
      font-size: 1.08em;
      margin-bottom: 13px;
      color: #273b1b;
    }
    .required { color: #d02d44; }
    #status {
      margin-top: 22px;
      font-weight: bold;
      font-size: 1.13em;
      letter-spacing: 0.2px;
      color: #4C9A2A;
    }
    .checkbox-list label {
      display: block;
      margin-bottom: 4px;
      cursor: pointer;
      font-weight: 500;
      color: #357a38;
    }
    .checkbox-list input[type=checkbox] {
      margin-right: 8px;
      accent-color: #8DC63F;
      vertical-align: middle;
    }
    .checkbox-list input[type=text] {
      width: 170px;
      margin-left: 6px;
      font-style: italic;
      background: #f4faff;
    }
    .ggi-footer {
      text-align: center;
      font-size: 0.98em;
      padding: 19px 0 13px 0;
      color: #4C9A2A;
      background: #f1f8e9;
      letter-spacing: 0.3px;
    }
    .ggi-footer a {
      color: #8DC63F;
      text-decoration: underline;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <header>
    <img class="logo" src="https://cdn.gogreeninitiative.org/logo/gogreen-initiative-logo.png" alt="Go Green Initiative Logo">
    <h1>Indoor Air Quality Walkthrough</h1>
    <div class="tagline">A Go Green Initiative Tool for School Facilities</div>
  </header>
  <form id="iaqForm" autocomplete="off">

    <label>Email Address <span class="required">*</span></label>
    <input type="email" name="email" required placeholder="your@email.com">
    <label>Assessment Date <span class="required">*</span></label>
    <input type="date" name="assessment_date" required>
    <label>Inspector Name <span class="required">*</span></label>
    <input type="text" name="inspector_name" required>
    <br><br>

    <!-- Mechanical Ventilation Section -->
    <div class="section" style="border-top:none; margin-top: 0;">
      <label class="section-title">
        If this facility has mechanical ventilation, select all that apply:
      </label>
      <div class="checkbox-list" id="mech_vent_types_section" style="margin-top:10px;">
        <label><input type="checkbox" name="mech_vent_types" value="Central air handling units"> Central air handling units</label>
        <label><input type="checkbox" name="mech_vent_types" value="Unit ventilators"> Unit ventilators</label>
        <label><input type="checkbox" name="mech_vent_types" value="Packaged rooftop units"> Packaged rooftop units</label>
        <label><input type="checkbox" name="mech_vent_types" value="Dedicated outdoors air systems"> Dedicated outdoors air systems</label>
        <label><input type="checkbox" name="mech_vent_types" value="Variable air volume systems"> Variable air volume systems</label>
        <label><input type="checkbox" name="mech_vent_types" value="Fan coil units"> Fan coil units</label>
        <label><input type="checkbox" name="mech_vent_types" value="Exhaust only/relief ventilation"> Exhaust only/relief ventilation</label>
        <label><input type="checkbox" name="mech_vent_types" value="Not applicable"> Not applicable</label>
        <label>
          <input type="checkbox" name="mech_vent_types" value="Other" id="mech_vent_other_checkbox">
          Other:
          <input type="text" id="mech_vent_other_text" name="mech_vent_other_text" style="width: 170px;" disabled placeholder="Please specify">
        </label>
      </div>
    </div>

    <div id="rooms-container"></div>
    <button type="button" class="add-room-btn" onclick="addRoom()">+ Add Room</button>
    <br>

    <button type="submit" style="font-size:1.15em;margin-top:14px; background:linear-gradient(90deg,#8DC63F,#4C9A2A);border:none;border-radius:8px;padding:13px 32px;color:#fff;font-family:'Roboto',Arial,sans-serif;font-weight:700;letter-spacing:0.6px;box-shadow:0 2px 8px #4C9A2A22;transition:background .18s;cursor:pointer;">Submit & Receive Your Google Sheet</button>
  </form>
  <div id="status"></div>
  <div class="ggi-footer">
    &copy; 2025 <a href="https://gogreeninitiative.org/" target="_blank" rel="noopener">Go Green Initiative</a> &mdash; Empowering sustainable schools.
  </div>
  <script>
    const ROOM_TYPES = [
      "Classroom", "Main Office", "Mechanical Room", "Storage Room", "HVAC Rooms", "Electrical Room",
      "Bathroom/Locker Rooms", "Kitchen", "Cafeteria", "Nurse Office", "Custodial Room", "Pool Room/Indoor Pool",
      "Multipurpose Room", "Gym", "CTE/Arts/Science Rooms", "Staff Lounge", "Other"
    ];

    const SECTIONS = [
      {
        title: "Classroom Occupancy",
        questions: [
          "If this is a classroom, is the teacher present?",
          "If the teacher is present, ask them about any IAQ issues, if they identify any, note them in the notes section."
        ]
      },
      {
        title: "HVAC & Ventilation",
        questions: [
          "Is the IAQ monitor functioning properly?",
          "Are HVAC units operating properly?",
          "Are HVAC vents and air intakes unobstructed?",
          "Are there any odors coming from the HVAC system?",
          "Is the room temperature too hot or too cold?",
          "Is there an air purifier present?"
        ]
      },
      {
        title: "Mold & Moisture",
        questions: [
          "Are there any water stains on the floor?",
          "Are there any water stains on the walls?",
          "Are there any water stains on the ceiling?",
          "Are there any signs of leakage from radiators?",
          "Is there visible condensation on windows, pipes, or other surfaces?",
          "Are there any visible signs of mold growth?",
          "Are there any mold stains on the floor, walls, or ceiling?",
          "Are there any odd or musty smells? (if there are smells, describe them in the notes section)"
        ]
      },
      {
        title: "Pests",
        questions: [
          "Are there any pest droppings?",
          "Are there any other signs of pests?",
          "Is food stored in the classroom?",
          "If food is present, is it kept in air-tight, sealed containers?"
        ]
      },
      {
        title: "Chemical & Material Safety",
        questions: [
          "Are all chemicals stored appropriately?",
          "Are there any visible chemical hazards?",
          "Are all cleaners present safer choice? Any unauthorized cleaners or air fresheners present?"
        ]
      },
      {
        title: "General Environment & Cleanliness",
        questions: [
          "Is there visible dust on surfaces?",
          "Is there excess clutter present?",
          "Are there plants present?",
          "Are there pets present?",
          "Is there peeling or flaking paint present?"
        ]
      },
      {
        title: "Energy Efficiency",
        questions: [
          "Are lights equipped with occupancy sensors or automatic dimming controls?",
          "Do exterior doors have intact seals, with no visible cracks or gaps?",
          "Do windows have intact seals, with no visible cracks, gaps, or drafts?",
          "Are any windows broken or damaged?",
          "Are any doors broken, damaged, or unable to close properly?",
          "Are window shades or blinds installed in classrooms and other spaces?",
          "Do the shades/blinds operate properly to control sunlight and reduce heat gain or glare?",
          "Are fume hoods present in laboratory classrooms?",
          "Are fume hood sashes kept closed when not in use to conserve energy and maintain proper ventilation balance?"
        ]
      },
      {
        title: "Outdoor Intakes",
        questions: [
          "Are outdoor air intakes located away from pollution sources (e.g., idling vehicles, dumpsters)?",
          "Are intakes free of debris, leaves, or obstructions?",
          "Are school dumpsters and loading docks located away from building air intakes?",
          "Are portable classrooms placed in areas with good airflow and no standing water nearby?",
          "Are playgrounds, pickup/drop-off zones, and bus areas monitored for idling compliance?"
        ]
      },
      {
        title: "Conclusion",
        questions: [
          "Are there any other concerns or notes generally about this room that you want to document?"
        ]
      },
      {
        title: "If this is a Mechanical/HVAC/Electrical Room, answer the appropriate questions below:",
        questions: [
          "Is the mechanical room clean and free of stored materials?",
          "Are air intake areas clear of debris, bird nests, or vegetation?",
          "Are drain pans clean and free of standing water?",
          "Are filters installed correctly and labeled with change dates?",
          "Are belts, motors, and coils in good condition (no visible wear or residue)?",
          "Is there any sign of rust, corrosion, or oil leaks on equipment?"
        ]
      }
    ];

    let roomCount = 0;

    function addRoom(roomData = null) {
      const container = document.getElementById('rooms-container');
      const roomId = `room-${++roomCount}`;

      let roomBlock = document.createElement('div');
      roomBlock.className = 'room-block';
      roomBlock.id = roomId;

      // Room title and remove button
      let titleDiv = document.createElement('div');
      titleDiv.className = 'room-title';
      titleDiv.innerHTML = `Room #${roomCount}`;
      let removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'remove-room-btn';
      removeBtn.textContent = 'Remove';
      removeBtn.onclick = () => container.removeChild(roomBlock);
      titleDiv.appendChild(removeBtn);
      roomBlock.appendChild(titleDiv);

      // Room Name/Number
      let rn = document.createElement('input');
      rn.type = 'text';
      rn.name = `room_name`;
      rn.required = true;
      rn.placeholder = 'Room Name/Number';
      rn.value = roomData ? roomData.room_name : '';
      roomBlock.appendChild(rn);

      // Room Type dropdown
      let rt = document.createElement('select');
      rt.name = `room_type`;
      rt.required = true;
      for (let t of ROOM_TYPES) {
        let opt = document.createElement('option');
        opt.value = t;
        opt.textContent = t;
        rt.appendChild(opt);
      }
      rt.value = roomData ? roomData.room_type : '';
      roomBlock.appendChild(rt);

      // All IAQ sections/questions
      SECTIONS.forEach((section, sidx) => {
        let secDiv = document.createElement('div');
        secDiv.className = 'section';
        let secLabel = document.createElement('label');
        secLabel.className = 'section-title';
        secLabel.textContent = section.title;
        secDiv.appendChild(secLabel);

        section.questions.forEach((q, qidx) => {
          let qDiv = document.createElement('div');
          qDiv.className = 'question-group flex';
          let qSpan = document.createElement('span');
          qSpan.textContent = q;
          let sel = document.createElement('select');
          sel.name = `q_${sidx}_${qidx}_answer`;
          sel.required = false;
          ["", "Yes", "No", "NA"].forEach(optVal => {
            let opt = document.createElement('option');
            opt.value = optVal;
            opt.textContent = optVal === "" ? "--Select--" : optVal;
            sel.appendChild(opt);
          });
          sel.value = roomData ? (roomData[`q_${sidx}_${qidx}_answer`] || "") : "";
          let notes = document.createElement('input');
          notes.type = "text";
          notes.className = "notes";
          notes.name = `q_${sidx}_${qidx}_notes`;
          notes.placeholder = "Notes/comments";
          notes.value = roomData ? (roomData[`q_${sidx}_${qidx}_notes`] || "") : "";

          qDiv.appendChild(qSpan);
          qDiv.appendChild(sel);
          qDiv.appendChild(notes);

          secDiv.appendChild(qDiv);
        });
        roomBlock.appendChild(secDiv);
      });

      container.appendChild(roomBlock);
    }

    // Add one room block by default
    window.onload = () => addRoom();

    // Enable/disable "Other" text box based on checkbox
    document.addEventListener("DOMContentLoaded", function() {
      const otherCB = document.getElementById('mech_vent_other_checkbox');
      const otherText = document.getElementById('mech_vent_other_text');
      otherCB.addEventListener('change', function() {
        otherText.disabled = !this.checked;
        if (!this.checked) otherText.value = "";
      });
    });

    document.getElementById('iaqForm').onsubmit = async function(e) {
      e.preventDefault();
      document.getElementById('status').innerText = "Submitting...";

      // Collect top-level fields
      const form = e.target;
      const email = form.email.value.trim();
      const assessment_date = form.assessment_date.value;
      const inspector_name = form.inspector_name.value.trim();

      // Mechanical ventilation checkboxes
      let mech_vent_types = [];
      for (const cb of form.querySelectorAll('input[name="mech_vent_types"]:checked')) {
        if (cb.value === "Other" && form.mech_vent_other_text.value.trim())
          mech_vent_types.push("Other: " + form.mech_vent_other_text.value.trim());
        else if (cb.value !== "Other")
          mech_vent_types.push(cb.value);
      }

      // Collect all rooms
      const rooms = [];
      const container = document.getElementById('rooms-container');
      for (const roomBlock of container.children) {
        const inputs = roomBlock.querySelectorAll('input, select');
        const room = {};
        for (const input of inputs) {
          if (input.name === 'room_type') {
            room.room_type = input.value;
          } else if (input.name === 'room_name') {
            room.room_name = input.value.trim();
          } else if (input.name.startsWith('q_') && input.name.endsWith('_answer')) {
            room[input.name] = input.value;
          } else if (input.name.startsWith('q_') && input.name.endsWith('_notes')) {
            room[input.name] = input.value;
          }
        }
        rooms.push(room);
      }

      // Replace with your deployed Google Apps Script Web App URL
      const SCRIPT_URL = "YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL";

      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          body: JSON.stringify({
            email, assessment_date, inspector_name, mech_vent_types, rooms
          }),
          headers: { "Content-Type": "application/json" }
        });
        const json = await res.json();
        if (json.success) {
          document.getElementById('status').innerHTML =
            `Submission successful! <br>Check your email for the Google Sheet link.`;
          form.reset();
          document.getElementById('rooms-container').innerHTML = "";
          addRoom();
        } else {
          document.getElementById('status').innerText = "Submission failed: " + json.message;
        }
      } catch (err) {
        document.getElementById('status').innerText = "Submission error: " + err;
      }
    };
  </script>
</body>
</html>